## Abstract

실제 이미지는 사이즈가 크며, 다운 샘플링 작업이 필요하다.

이는 계산 및 필요한 통신 대역폭을 줄이더라도 중복 및 중요 정보를 모두 제거하므로 정확도가 떨어진다.

이 논문에서는 디지털 신호 처리 이론에 영감을 받아 주파수 관점에서 스펙트럼 편향을 분석하고 정확도 손실 없이 제거할 수 있는 사소한 주파수 성분을 식별하기 위한 학습 기반 주파수 선택 방법을 제안하며 데이터 크기를 더 줄일 수 있다는 것과 높은 정확도를 달성한다.

## 1. Introduction

영상 축소는 불가피하게 정보 손실과 정확도 저하를 초래하며 Prior works는 task-aware downsizing networks를 학습함으로써 정보 손실을 줄이는 것을 목표로 함. 

<p align="center"><img src="https://user-images.githubusercontent.com/45933225/77687862-75ed4f00-6fe2-11ea-9e37-95c2416eacbe.png" width="70%"></p>

본 논문에서는 주파수 영역, 즉 공간 영역에서 크기를 조정하지 않고 이산 코사인 변환(DCT)도메인의 고해상도 영상을 다시 만든 다음 재구성된 DCT계수를 CNN모델에 전달하여 추론을 할 것을 제안하며 이는 필요한 칩 간 통신 대역폭의 직접적인 감소로 이어지며, 이 대역폭은 Deep Learning Inference System의 병목현상으로 이어짐.

인간 시각 시스템(HVS)이 다른 주파수 성분에 대해 동일하지 않은 민감도를 가지고 있다는 것을 빌미 삼아 주파수 영역의 영상 분류, 탐지 및 분할 작업을 분석하여, CNN모델이 HVS와 일치하는 고주파 채널보다 저주파 채널에 더 민감하다는 것을 알았음.

이 관찰은 복수의 "ON-OFF 스위치"로 구성된 학습 기반 채널 선택 방법에 의해 검증되며 CNN모델의 스펙트럼 편향성 때문에 추론하는 동안 정확성을 잃지 않고 중요한 주파수 채널만 유지할 수 있었음.

본 논문에서는 추론을 위해 전체 주파수 스펙트럼을 사용하는 대신 중요한 채널을 보존하기 위한 정적 채널 선택 접근법을 개발함.
따라서 실험 결과 데이터 크기가 감소해도 여전히 동일한 정확도를 유지할 수 있었음.

## 2. Related Work

#### Learning in the frequency domain

주파수 영역의 압축된 표현에는 이미지 이해 작업을 위한 풍부한 패턴이 포함되어 있다. 압축 및 추론 작업에 대한 전용 자동 인코더 기반 네트워크를 공동으로 교육한다. 주파수 영역에서 형상을 추출하여 영상을 분류한다.  공간 도메인 CNN 모델을 주파수 영역으로 변환하는 모델 변환 알고리즘을 제안한다. 이 방법은 두 가지 면에서 이전 작품과 다르다. 첫째, 우리는 공간적 영역에서 주파수 영역으로의 복잡한 모델 전환 절차를 피한다. 따라서, 우리의 방법은 더 넓은 적용 범위를 가지고 있다. 둘째, 주파수 영역에서 신경망의 스펙트럼 편향을 해석하는 분석 방법을 제공함.

#### Dynamic Neural Networks

Prior works 에서는 이전 blocks의 활성화를 바탕으로 즉시 convolutional blocks을 선택적으로 건너뛸 것을 제안하며 이 작업들은 각 convolutional blocks의 입력에 대응하여 모델 복잡성을 조정한다. 입력과 가장 관련이 있는 중간 형상만 추론 단계에서 계산하여 계산 비용을 절감한다. 이와는 대조적으로, 우리의 방법은 오직 raw 입력에 대해서만 작동하며 입력 데이터에 대한 통신 대역폭 요구량을 낮추기 위해 중요한 주파수 구성 요소를 뽑아냄.

#### Efficient Network Training

효율적인 네트워크를 구성하기 위해 kernel pruning, learned quantization, entropy encoding을 통한 네트워크 압축에 초점을 맞추고 있다. 또 다른 작업 라인은 주파수 영역에서 CNN 모델을 압축하는 것을 목표로 한다. 그리고 필터 가중치를 주파수 영역으로 변환하고 hash function를 사용하여 주파수 매개변수를 hash bucket으로 그룹화하여 저장 공간을 줄인다. 또한 커널을 주파수 영역으로 변환하고 높은 압축에 대한 저 에너지 주파수 계수를 폐기한다. CNN 커널의 주파수 스펙트럼을 제한하여 메모리 소모를 줄인다.  이러한 네트워크 압축은 주파수 영역에서 모두 FFT 기반 컨볼루션에 의존하며, 일반적으로 더 큰 커널에 더 효과적임.
이와는 대조적으로 CNN 모델을 거의 수정하지 않고 연산 효율을 향상시키기 위한 추가적인 노력을 필요로 하지 않으며 복잡한 모델보다 입력 데이터 크기를 줄이는 것을 목표로 함.

## 3. Methodology

이 방법에서 고해상도 RGB 이미지는 여전히 CPU에 미리 처리되어 있다.

그러나, 그것들은 처음에는 YCbCr 색공간으로 변환되고 그 다음에는 주파수 영역으로 변환된다.

이것은 JPEG와 같이 가장 널리 사용되는 이미지 압축 표준과 일치한다. 동일한 주파수의 모든 구성요소는 하나의 채널로 그룹화된다. 이 방법으로 복수의 주파수 채널이 생성됨.

특정 주파수 채널은 다른 주파수보다 추론 정확도에 더 큰 영향을 끼치며 가장 중요한 주파수 채널만 보존하고 GPU/AI accelerators로 전송할 것을 제안하며 이는 통신 대역폭을 적게 필요로 하고 동시에 더 높은 정확도를 달성하며 주파수 영역의 입력 기능을 최소한의 수정으로 공간 영역에서 개발된 모든 기존 CNN 모델에 적용할 수 있음을 증명함.

이와 같이 수정된 모델은 원래 모델과 유사한 매개변수 수와 계산 복잡성을 유지할 수 있다.

주파수 영역 모델에 기초하여, 주어진 CNN 모델의 스펙트럼 편향을 탐구하기 위한 학습 기반 채널 선택 방법, 즉 어떤 주파수 구성요소가 후속 추론 작업에 더 유용한지를 제안한다. 이 발견은 추론을 위한 사소한 주파수 구성요소를 제거하도록 동기를 부여하며, 이는 입력 데이터 크기를 현저히 감소시켜 결과적으로 추론 정확도를 유지하면서 도메인 변환의 계산 복잡성과 필요한 통신 대역폭 모두를 감소함.

### 3.1 Data Preprocessing in the Frequency Domain

<p align="center"><img src="https://user-images.githubusercontent.com/45933225/77687878-7ab20300-6fe2-11ea-92b6-601533a249e5.png" width="70%"></p>

다음은 그림은 데이터 전처리 흐름을 보여주며 아래 과정에 대한 설명을 보여줌.

	- 이미지 크기 조정, 자르기 및 플립으로 구성된 공간 영역에서 잘 발달된 preprocess 및 augmentation 흐름을 따름.
	- 다음 영상이 YCbCr 색상 공간으로 변환되고 주파수 영역으로 변환됨.
	- 그 후, 동일한 주파수의 2차원 DCT계수를 한 채널로 그룹화하여 3차원 DCT 큐브를 형성함.
	- 높은 영향을 미치는 주파수 채널의 서브셋을 선택하며 YCbCr 색 공간의 선택된 주파수 채널은 하나의 텐서를 형성하기 위해 함께 연결됨.
	- 마지막으로, 모든 주파수 채널은 training Dataset에서 계산한 평균과 분산에 의해 정규화 됨.

DCT 재조정 연산에는 2차원 DCT 계수가 3차원 DCT 큐브에 그룹화되며 JPEG 압축 표준은 YCbCr 색상 공간에서 8*8 DCT 변환을 사용하므로, 모든 8 * 8 블럭에서 동일한 주파수의 구성요소를 하나의 채널로 그룹화하여 각 주파수에서 공간 관계를 유지한다. 따라서 Y, Cb, Cr 성분은 주파수 영역 내에 총 192개의 채널로 각 주파수마다 하나씩 8 * 8 = 64개의 채널을 제공함.

이것은 RGB 입력 영상이 모양이 H*W*C 가정할 경우, 주파수 영역으로 변환한 후, 입력 feature shape는 동일한 입력 데이터 크기를 유지하는 H/8*W/8*64C가 됨.
주파수 영역의 입력 feature map은 공간 도메인 상대보다 크기 때문에 일반적인 CNN 모델의 입력 레이어를 건너뛴다. 이것은 보통 stride-2 convolution이라고 함.

<p align="center"><img src="https://user-images.githubusercontent.com/45933225/77687883-7dacf380-6fe2-11ea-8dc2-38970d8a603c.png" width="70%"></p>

Max-pooling 연산자가 즉시 입력 convolution을 따를 경우, Max-pooling 연산자도 건너뛴다. 그런 다음 주파수 영역의 채널 수와 일치하도록 다음 계층의 채널 크기를 조정함.

이런 식으로, 주파수 영역의 특징을 입력으로 받아들이도록 기존의 CNN 모델을 최소한으로 조정함.

주파수 영역에서 분류를 수행하면 더 큰 영상을 입력으로 취할 수 있으며 대부분의 주파수 채널은 정확성을 희생하지 않고 폐기할 수 있음.

### 3.2 Learningbased Frequency Channel Selection

입력 기능의 채널이 서로 다른 주파수에 있기 때문에, 일부 주파수 채널이 영상 분류, 물체 감지 및 분할과 같은 후속 작업에 더 많은 정보를 제공하고 사소한 주파수 채널을 제거하면 성능이 저하되지 않을 것이라고 추측함. 따라서 각 입력 주파수 채널의 상대적 중요성을 이용하기 위한 학습 기반 채널 선택 메커니즘을 제안함.

각 주파수 채널에 이진 점수를 할당하는 동적 게이트 모듈을 사용한다. 따라서 중요성을 구별하여 입력 데이터 크기가 줄어들어 도메인 변환의 연산 복잡성과 통신 대역폭 요구사항이 감소됨.

<p align="center"><img src="https://user-images.githubusercontent.com/45933225/77687899-856c9800-6fe2-11ea-8184-6bb953dfb66d.png" width="70%"></p>

위 그림에서 보여주는 게이트 모듈의 설명이다.

	- Tensor1 : H*W*C (C=192)
	- Tensor2 : average pooling에 의해 모양 1 * 1 * C로 변환.
	- Tensor3 : 1*1 convolutional layer 의해 형상 1 * 1 * C로 변환.
	- Tensor4 : Tensor1 ~ Tensor3으로 변환하는 것은 채널 정보를 활용하여 정보적 특징을 강조하고 사소한 것을 억제하는 SE block과 동일함. 그런 다음, Tensor3의 모든 요소에 2개의 교육 가능한 매개변수를 곱하여 형상 1 * 1* c*2로 변환.
	- Tensor5 : 추론하는 동안, Tensor4의 192개 채널 각각에 대한 2개의 숫자가 정규화되고 0 또는 1로 샘플링될 확률로 작용한 다음, 점으로 입력 주파수 채널에 곱함. (선택적인 채널 메커니즘을 구성)
	- Gumbel samples : 별도의 샘플링 과정을 통해 gradients가 역전파(back propagate) 될 수 있도록 하는 Gumbel Softmax trick이라고 하는 재변형 방법. 

#### 게이트 모듈이 기존 SE Block과 다른 두가지.

	- 게이트 모듈은 차원 1*1*C*2의 Tensor를 출력하며, 마지막 차원의 두숫자는 각 주파수 채널에 대해 각각 켜지거나 꺼질 확률을 설명함(변환을 위해 다른 1*1 convolution 계층을 추가).
	- 각 주파수 채널에 곱한 숫자는 0 또는 1이다. 즉, 주파수를 사용하느냐 안 하느냐의 이진 결정이다.

#### 게이트 모듈의 문제점.
Bernoulli 분포 Bern(p)을 샘플링하여 결정하며, 여기서 p는 위에 언급한 1 * 1 * C*2 Tensor 2개의 숫자로 계산됨.

	- 가중치를 업데이트 해야하는 경우 Bernoulli 샘플링 프로세스를 차별화할 수 없음.

따라서 위 게이트 문제점을 보완하고자 Gumbel Softmax trick이라고 하는 재변형 방법을 제안함.
CNN 모델의 주파수 영역(C = 192)의 입력 채널로 설정. 

<p align="center"><img src="https://user-images.githubusercontent.com/45933225/77687914-8bfb0f80-6fe2-11ea-9af1-22bd5a149695.png" width="50%"></p>

F가 각 주파수 채널 xi에 대해 F(xi) {0, 1}과 같은 제안 게이트 모듈을 나타내도록 한다. 그런 다음 xi는 위와같이 선택됨(◉는 element-wise product).

<p align="center"><img src="https://user-images.githubusercontent.com/45933225/77687918-8ef60000-6fe2-11ea-8218-0c95da816dc0.png" width="50%"></p>

교차-엔트로피 손실 또는 기타 정확도 관련 손실과 함께 최소화되는 선택된 주파수 채널의 수와 균형을 이루는 손실 함수에 정규화 용어를 추가하였음(LAcc는 정확성과 관련된 손실). 

### 3.3 Static Frequency Channel Selection

학습 기반 채널 선택은 각 주파수 채널의 중요도에 대한 동적 추정을 제공함. 즉, 다른 입력 이미지는 활성화된 주파수 채널의 하위 집합을 가질 수 있음.

<p align="center"><img src="https://user-images.githubusercontent.com/45933225/77687933-91f0f080-6fe2-11ea-991c-204a352a28f2.png" width="70%"></p>

주파수 채널 활성화 패턴을 이해하기 위해 분류 작업(a), 분할 작업(b)의 두 히트 맵을 보여줌.

	- 각 상자의 숫자는 채널의 주파수 색인을 나타내며, 각각 더 낮은 주파수와 더 높은 주파수를 나타냄.
	- Heat map 값은 모든 유효성 검사 영상에서 추론을 위해 선택된 주파수 채널의 가능성을 나타냄.

Heat map 패턴을 기반으로 몇 가지 관측을 수행함.

	- 저주파 채널(작은 지수를 가진 상자)은 고주파 채널(큰 지수를 가진 상자)보다 훨씬 더 자주 선택된다. 이것은 저주파 채널이 비주얼 추론 작업에 일반적으로 고주파 채널보다 더 유용하다는 것을 보여줌.
	- luma 성분 Y의 주파수 채널은 chroma 성분 Cb와 Cr의 주파수 채널보다 더 자주 선택된다. 이것은 luma 성분이 visual 추론 작업에 더 유용하다는 것을 의미함.(JPEG 압축 표준은 저주파 및 luma 성분에 더 많은 비트를 넣는다. 같은 원리에 따라 chroma 성분보다 luma 성분을 더 강조하여 저주파 채널을 정적으로 선택한다. 이로써 활성화 확률이 높은 주파수 채널이 CNN 모델로 공급된다. 나머지 주파수 채널은 필요한 데이터 전송 대역폭과 입력 데이터 크기를 줄이기 위해 이미지 인코더 또는 디코더에 의해 잘라낼 수 있다.)
	- Heat maps은 분류 작업과 분할 작업 사이의 공통 패턴을 공유한다. 이는 위에서 언급한 두 가지 관찰이 한 가지 작업에만 한정되지 않고 보다 높은 수준의 vision tasks에는 일반적일 가능성이 매우 높다는 것을 나타냄.
	- 일부 낮은 주파수 채널은 약간 높은 주파수 채널보다 선택될 확률이 낮다. 예를 들어, Cb와 Cr 구성 요소에서 두 작업은 채널 5와 3보다 채널 6과 9를 선호함.

이러한 관측은 CNN 모델이 실제로 HVS와 유사한 특성을 보일 수 있으며, 영상 압축 표준이 CNN 모델에도 적합할 수 있다는 것을 의미함.

## 4 Experiment Results

이미지 분류, 탐지 및 분할이라는 세 가지 다른 높은 수준의 vision tasks에서 벤치마킹함.

### 4.1 Experiment Settings on Image Classification

	Dataset - ImageNet 2012 Large-Scale
	Optimizer - 확률적 경사 하강(SGD), lr=0.1, momentum=0.9, weight decay=4e-5 적용.
	Model - ResNet-50, MobileNetV2(Residual blocks 및 깊이 분리 가능한 컨볼루션을 포함하여서 선택함.)
	Epoch - 90, 150epochs 교육함. 그리고 30, 50epochs마다 lr 0.1씩 감소.
	Input channels normalization - 192개 주파수 채널의 평균과 분산을 training Dataset의 모든 영상에 대해 별도로 계산함. 이것은 이전에 설명한 주파수 영역의 입력 형상은 공간 영역보다 분해능이 훨씬 높은 영상에서 생성됨을 말함. 그러나 Dataset의 일부 이미지는 해상도가 낮다. 따라서 업샘플링을 수행함.

### 4.2 Experiment Results on Image Classification

<p align="center"><img src="https://user-images.githubusercontent.com/45933225/77687947-961d0e00-6fe2-11ea-9754-d8bdf9420ecf.png" width="70%"></p>

위 표를 통해서 Channels, Normalized Input Size에 따라 다른 결과를 확인할 수 있음.

###### 4.3 Experiment Settings on Instance Segmentation, 4.3 Experiment Results on Instance Segmentation 부분은 생략함. - 직접 읽어보기.

## 5. Conclusion

주파수 영역에서의 학습 방법(DCT계수를 입력으로 사용)을 제안하고 일반성과 우월성을 입증하며, 기존의 CNN 모델에 거의 수정이 필요하지 않기 때문에 일반적으로 기존의 네트워크 훈련과 추론 방법에 적용될 수 있음. 결과적으로 사전 처리 단계에서 영상 정보를 더 잘 보존하고 향상된 정확도를 달성한다는 것을 보여줌. 우리는 학습 기반의 동적 채널 선택 방법을 제안하며 CNN모델이 고주파 채널보다 저주파 채널에 더 민감하다는 것을 보여줌.
